---
    - name: Update Repository
      apt: 
        update_cache: yes
        become: yes
    - name: Install apache, php
      apt: 
        name: apache2
        state: installed  
      with_items:
        - php7.2
        - libapache2-mod-php7.2
    - name: Start apache service
      service:
        name: apache2
        state: started
        enabled: yes
    - name: Get wordpress from source
      get_url:
        url: http://wordpress.org/latest.tar.gz
        dest: /var/www/lastest.tar.gz
    - name: Uncompress wordpress tar ball
      unarchive: 
        src: /var/www/lastest.tar.gz
        dest: /var/www/dungnt.com
    - name: Change owner and mode
      file:
        path: /var/www/dungnt.com
        owner: www-data
        group: www-data
        mode: '0644'
    - name: Copy a created wp-config.php and backup it
      template:
        src: /etc/ansible/wp-config.php
        dest: /var/www/dungnt.com/wp-config.php
      backup: yes
    - name: Copy an edited default configuration of Apache and backup it
      template:
        src: /etc/ansible/000-default.conf
        dest: /etc/apache2/sites-available/000-default.conf
        backup: yes
      notify: restart apache
    - name: Add ha entry in /etc/hosts 
      lineinfile:
        path: /etc/hosts
        line: “{{ hostvars[‘ha’].ansible_host }} ha”
        state: present
    - name: Add web server 1 entry in its /etc/hosts when the ip is 103.107.182.45
      command: "echo'103.107.182.45 dungnt.com' >> /etc/hosts"
      when: ansible_host == "web1"
    - name: Add web server 2 entry in its /etc/hosts when the ip is 103.107.182.199
      command: "echo'103.107.182.199 dungnt.com' >> /etc/hosts"
      when: ansible_host == "web2"
  handlers:
    - name: restart apache
      service: 
        name: apache2
        state: restarted
